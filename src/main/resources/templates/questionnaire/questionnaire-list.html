<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ru">
<head>
    <style>
        .form-control.is-valid:focus, .was-validated :valid.form-control {
            border-color: inherit !important;
            background-image: inherit !important;
            box-shadow: inherit !important;
        }

    </style>
    <meta charset="utf-8"/>
    <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/>
    <meta content="" name="description"/>
    <meta content="" name="author"/>
    <link href="/img/caret-down-square-fill.svg" rel="icon" type="image/x-icon">
    <title>Список опросников</title>
    <link href="https://cdn.jsdelivr.net/npm/simple-datatables@latest/dist/style.css" rel="stylesheet"/>
    <link href="/styles/styles.css" rel="stylesheet"/>
    <link href="/styles/scrollbar-style.css" rel="stylesheet"/>
    <script crossorigin="anonymous" src="https://use.fontawesome.com/releases/v6.1.0/js/all.js"></script>
    <script crossorigin="anonymous" integrity="sha384-7aHh9lqPYGYZ7sTHvzP1t3BAfLhYSTy9ArHdP3Xsr9/3TlGurYgcPBoFmXX2TX/w"
            src="https://unpkg.com/htmx.org@1.8.5"></script>
</head>

<body class="sb-nav-fixed">

<div th:insert="~{fragments/headerNavPanel :: headerNavPanel}" ></div>


<div id="layoutSidenav">

    <div id="layoutSidenav_nav" th:insert="~{/fragments/leftNavPanel.html :: leftNavPanel}" ></div>

    <div id="layoutSidenav_content" >
        <main>
            <div class="container-fluid px-4">
                <h1 class="mt-4">Опросники</h1>

                <div class="card mb-4">
                    <div class="card-header">
                        <i class="fas fa-table me-1"></i>
                        Список опросников
                    </div>
                    <div id="card-body" class="card-body" th:fragment="page-content">

                        <div class="input-group mb-3">

                            <div class="mt-3 mb-3 w-75 me-auto" id="questionnaires-find-bar">
                                <input aria-describedby="basic-addon2"
                                       th:value="${questionnaireSearchDto.title}"
                                       th:field="*{questionnaireSearchDto.title}"
                                       class="form-control"
                                       placeholder="Название опросника"
                                       style="border-color:inherit" type="text"
                                       hx-trigger="keyup changed delay:500ms, search"
                                       th:attr="hx-get=@{/questionnaires/action(pageNumber=${pageNumber}, orderType=${questionnaireSearchDto.orderType})}"
                                       hx-target="#card-body">
                            </div>

                            <div class="input-group mb-3 mt-3 w-auto" id="questionnaires-sort-bar">
                                <div class="input-group-prepend w-auto float-md-end">
                                    <label class="input-group-text" for="sort-type-select">Сортировка:</label>
                                </div>
                                <select class="custom-select w-auto float-md-end" id="sort-type-select"
                                        th:field="*{questionnaireSearchDto.orderType}"
                                        hx-params="*"
                                        hx-trigger="change"
                                        th:attr="hx-get=@{/questionnaires/action(pageNumber=${pageNumber}, title=${questionnaireSearchDto.title})}"
                                        hx-target = "#card-body">
                                    <option selected value="ASC">От А до Я</option>
                                    <option value="DESK">От Я до А</option>
                                </select>
                            </div>

                        </div>

                        <div id="tablePag">

                            <div th:fragment="pagination-content">

                            <table class="table table-hover" id="questionnaires-list" >
                                <thead></thead>
                                <tbody>
                                    <tr th:each="questionnaire : ${questionnaires.content}" th:fragment="questionnaires" class="questionnaire">
                                        <td>
                                            <a th:href="@{/questionnaires/{id}(id=${questionnaire.id})}"
                                               th:text="${questionnaire.title}" class="field">
                                                questionnaire
                                            </a>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>

                            <div id="questionnaires-navigation-bar">
                                <ul class="pagination justify-content-center">
                                    <div class="pagination">
                                        <li class="page-item"
                                            th:classappend="${(questionnaires.getPageable().pageNumber == 0) ? 'disabled' : ''}">
                                            <a class="page-link"
                                               hx-target="#tablePag"
                                               hx-trigger="click"
                                               style="cursor: pointer"
                                               th:attr="hx-get=@{/questionnaires/pages(orderType=${questionnaireSearchDto.orderType}, title=${questionnaireSearchDto.title}, pageNumber=${1})}"
                                            >Первая</a>
                                        </li>
                                    </div>

                                    <div class="pagination">
                                        <li class="page-item"
                                            th:classappend="${(questionnaires.getPageable().pageNumber == 0) ? 'disabled' : ''}">
                                            <a class="page-link"
                                               hx-target="#tablePag"
                                               hx-trigger="click"
                                               style="cursor: pointer"
                                               th:attr="hx-get=@{/questionnaires/pages(orderType=${questionnaireSearchDto.orderType}, title=${questionnaireSearchDto.title}, pageNumber=${questionnaires.getPageable().pageNumber})}"
                                            >Назад</a>
                                        </li>
                                    </div>

                                    <div class="pagination" style="max-width: 50%;">

                                        <li class="page-item"
                                            th:each="pageNumber : ${#numbers.sequence(((questionnaires.getPageable().pageNumber - 1 >= 0)? questionnaires.getPageable().pageNumber: questionnaires.getPageable().pageNumber + 1), ((questionnaires.getPageable().pageNumber + 3 < questionnaires.totalPages)? questionnaires.getPageable().pageNumber + 2 : questionnaires.totalPages), 1)}"
                                            th:classappend="${(pageNumber == questionnaires.getPageable().pageNumber + 1) ? 'active' : ''}">
                                            <a class="page-link"
                                               hx-target="#tablePag"
                                               hx-trigger="click"
                                               style="cursor: pointer"
                                               th:attr="hx-get=@{/questionnaires/pages(pageNumber=${pageNumber}, orderType=${questionnaireSearchDto.orderType}, title=${questionnaireSearchDto.title})}"
                                               th:text="${pageNumber}"></a>
                                        </li>
                                    </div>

                                    <div class="pagination">
                                        <li class="page-item"
                                            th:classappend="${!(questionnaires.getPageable().pageNumber < questionnaires.totalPages - 1) ? 'disabled' : ''}">
                                            <a class="page-link"
                                               hx-target="#tablePag"
                                               hx-trigger="click"
                                               style="cursor: pointer"
                                               th:attr="hx-get=@{/questionnaires/pages(orderType=${questionnaireSearchDto.orderType}, title=${questionnaireSearchDto.title}, pageNumber=${questionnaires.getPageable().pageNumber + 2})}"
                                            >Вперед</a>
                                        </li>
                                    </div>

                                    <div class="pagination">
                                        <li class="page-item"
                                            th:classappend="${!(questionnaires.getPageable().pageNumber < questionnaires.totalPages - 1) ? 'disabled' : ''}">
                                            <a class="page-link"
                                               hx-target="#tablePag"
                                               hx-trigger="click"
                                               style="cursor: pointer"
                                               th:attr="hx-get=@{/questionnaires/pages(orderType=${questionnaireSearchDto.orderType}, title=${questionnaireSearchDto.title}, pageNumber=${questionnaires.totalPages})}"
                                            >Последняя</a>
                                        </li>
                                    </div>
                                </ul>
                            </div>

                            </div>

                        </div>

                    </div>
                </div>


                <form class="input-group" th:method="GET" th:action="@{/questionnaires/new}">
                    <button type="submit" class="btn btn-secondary"  >Новый опросник</button>
                </form>

            </div>
        </main>
        <footer class="py-4 bg-light mt-auto" th:insert="~{/fragments/footer.html :: footer}"></footer>
    </div>
</div>

<div w3-include-html=""></div>
<script crossorigin="anonymous"
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="/js/scripts.js"></script>
<script crossorigin="anonymous" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js"></script>
<script crossorigin="anonymous" src="https://cdn.jsdelivr.net/npm/simple-datatables@latest"></script>
</body>


</html>